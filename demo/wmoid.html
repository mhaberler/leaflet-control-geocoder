<!DOCTYPE html>
<html>
  <head>
    <title>Leaflet Control Geocoder</title>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1"
      />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
    <link rel="stylesheet" href="../dist/Control.Geocoder.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
    
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
    <script src="../dist/Control.Geocoder.js"></script>
    <style type="text/css">
      body {
          margin: 0;
      }
      #map {
          position: absolute;
          width: 100%;
          height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script type="text/javascript">

      function failedSummary(jqXHR, textStatus, err) {
	  console.log("failedSummary", textStatus, err);
      }
      function gotSummary(summary) {
	  var geocoder = L.Control.Geocoder.wmoId({
	      summary: summary,
	      sizeInMeters: 20000
	      
	  });
	  summaryFmt = summary.properties.fmt;
	  var control = L.Control.geocoder({
              query: 'Stations',
              placeholder: 'location or station id',
              geocoder: geocoder,
	  }).addTo(map);
	  var marker;
	  console.log("gotSummary", summaryFmt, control);
      }
      var toplevel = 'https://radiosonde.mah.priv.at/';
      var datadir = 'data/';
      var datapath = toplevel + datadir;
      var summary_url = datapath + 'summary.geojson';
      var summary_br = 'summary.geojson.br';
      var sondeinfo_url = toplevel + 'static/' + 'sondeinfo.json';

      $.getJSON(summary_url)
    .done(function(data) {
        gotSummary(data);
    })
    .fail(function(jqXHR, textStatus, err) {
        failedSummary(jqXHR, textStatus, err);
    });
      
      var map = L.map('map').setView([0, 0], 2);

      L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      </script>
  </body>
</html>
